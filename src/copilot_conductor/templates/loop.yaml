# Loop-back workflow template
# A workflow that can iterate until a condition is met

workflow:
  name: {{ name }}
  description: A workflow with loop-back pattern for iterative refinement
  entry_point: generator
  limits:
    max_iterations: 10
    timeout_seconds: 300

agents:
  - name: generator
    model: gpt-4
    prompt: |
      Generate content based on the following request:
      {{ '{{' }} workflow.input.request {{ '}}' }}

      {% raw %}{% if reviewer.output %}{% endraw %}
      Previous feedback: {{ '{{' }} reviewer.output.feedback {{ '}}' }}
      Please improve based on this feedback.
      {% raw %}{% endif %}{% endraw %}
    output:
      content:
        type: string
        description: The generated content
    routes:
      - to: reviewer

  - name: reviewer
    model: gpt-4
    prompt: |
      Review the following content:
      {{ '{{' }} generator.output.content {{ '}}' }}

      Provide feedback and indicate if it's approved.
    output:
      approved:
        type: boolean
        description: Whether the content is approved
      feedback:
        type: string
        description: Feedback for improvement
    routes:
      - to: $end
        when: "{{ '{{' }} output.approved {{ '}}' }}"
      - to: generator

output:
  final_content: "{{ '{{' }} generator.output.content {{ '}}' }}"
  iterations: "{{ '{{' }} context.iteration {{ '}}' }}"
